<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./assets/resalalogo.jpg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>The Cup login</title>
    <link rel="stylesheet" href="./CSS/Bootstrap/bootstrap.css">
    <link rel="stylesheet" href="./CSS/style.css">
</head>

<body>
    
    <header class="header" id="header">
        <img src="./assets/farz logo.png" alt="farz logo">
    </header>
    <div class="center">
        <h1>Login</h1>
        <form>
            <div class="txt_field">
                <input type="email" id="email" required>
                <span></span>
                <label>Username</label>
            </div>
            <div class="txt_field">
                <input type="password" id="password" required>
                <span></span>
                <label>Password</label>
            </div>
            <input class="btn" id="login" type="submit" value="Login">
        </form>
    </div>
    <div id="snackbar">Wrong email or password</div>
    <div class="row justify-content-center">
    <div class="spinner-border" id="spin" style="width: 3rem; height: 3rem; margin-top: 35%;" role="status" hidden>
        <span class="visually-hidden">Loading...</span>
    </div>
    </div>
</body>
<script  type="module">
  
// Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC7oeKjthByrRm6EoF0gl5wjY528j4aWMM",
        authDomain: "resala-cup.firebaseapp.com",
        databaseURL: "https://resala-cup-default-rtdb.firebaseio.com",
        projectId: "resala-cup",
        storageBucket: "resala-cup.appspot.com",
        messagingSenderId: "920754872696",
        appId: "1:920754872696:web:18b4329eaf69d2dd8ee88d"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
export default class RoleMapping {
    static getCommittee(email) {
        const committeeMapping = {
            "hr@gmail.com": "hr",
            "etisalat@gmail.com": "Telecom",
            "monitoring@gmail.com": "follow-up",
            "exhibition@gmail.com": "Exhibitions",
            "feeding@gmail.com": "feeding",
            "feraq@gmail.com": "team",
            "champions@gmail.com": "challenge-champions",
            "advertisement@gmail.com": "Advertisements",
            "cubs@gmail.com": "cubs-committee",
            "doctor@gmail.com": "Dr-competitions",
            "CharityMarket@gmail.com": "MarketCommittee",
            "reconstruction@gmail.com": "reconstruction",
            "donate@gmail.com": "Donate"
        };
        
        
        return committeeMapping.hasOwnProperty(email);
    }
    static getCommittee2(email) {
        const committeeMapping = {
            "hr@gmail.com": "hr",
            "etisalat@gmail.com": "Telecom",
            "monitoring@gmail.com": "follow-up",
            "exhibition@gmail.com": "Exhibitions",
            "feeding@gmail.com": "feeding",
            "feraq@gmail.com": "team",
            "champions@gmail.com": "challenge-champions",
            "advertisement@gmail.com": "Advertisements",
            "cubs@gmail.com": "cubs-committee",
            "doctor@gmail.com": "Dr-competitions",
            "CharityMarket@gmail.com": "MarketCommittee",
            "reconstruction@gmail.com": "reconstruction",
            "donate@gmail.com": "Donate"
        };
        
        console.log(committeeMapping[email]);
        return committeeMapping[email];
    }
    static getBranch(email) {
        const branchMapping = {
                "maadi@gmail.com": "maadi",
                "alex@gmail.com": "alex",
                "October@gmail.com": "October",
                "ElMokattam@gmail.com": "El Mokattam",
                "Faisal@gmail.com": "Faisal",
                "Helwan@gmail.com": "Helwan",
                "Mohandessin@gmail.com": "Mohandessin",
                "nasercity@gmail.com": "naser city",
                "heliopolis@gmail.com": "new cairo"
            };
        
        
        return branchMapping.hasOwnProperty(email);
    }
    static getBranch2(email) {
        const branchMapping = {
                "maadi@gmail.com": "maadi",
                "alex@gmail.com": "alex",
                "October@gmail.com": "October",
                "ElMokattam@gmail.com": "El Mokattam",
                "Faisal@gmail.com": "Faisal",
                "Helwan@gmail.com": "Helwan",
                "Mohandessin@gmail.com": "Mohandessin",
                "nasercity@gmail.com": "naser city",
                "heliopolis@gmail.com": "new cairo"
            };
        
        
        return branchMapping[email];
    }
}
document.getElementById("login").addEventListener("click", async (e) => {
    e.preventDefault(); // Prevent form submission

    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    
        
        document.getElementById("spin").removeAttribute("hidden");
        signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
        const user = userCredential.user;

        const committee = RoleMapping.getCommittee(email);
        const branch=RoleMapping.getBranch(email);
        const committeeLocal=RoleMapping.getCommittee2(email);
        const branchLocal = RoleMapping.getBranch2(email);
            if(email=="admin@gmail.com"){
                window.location.href = "./html/admin/homePage.html";
            }
            else if(email=="techmanager@gmail.com"){
                window.location.href = "./html/moder/tanfezy.html";
            }
            else if (committee) {
                localStorage.setItem("committee", committeeLocal);
                window.location.href = "./html/committees/dashboard.html";
            } else if(branch) {
                localStorage.setItem("branch", branchLocal);
                window.location.href = "./html/users/committeesMenu.html";
            }
         else {
            alert("User not found");
        }
    }) .catch((error) => {
                const errorMessage = error.message;
                myFunction();
                document.getElementById("spin").setAttribute("hidden", "true");
            });
});

</script>
<script src="./JS/js/bootstrap.js"></script>
<script src="./JS/script.js"></script>

</html>